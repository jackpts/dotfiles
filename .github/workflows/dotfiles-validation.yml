name: Dotfiles Validation

on: [push, pull_request]

jobs:
  validate:
    runs-on: ubuntu-latest
    container: archlinux:latest

    steps:
      - name: Install system dependencies
        run: |
          set -euo pipefail
          pacman -Syu --noconfirm
          pacman -S --needed --noconfirm \
            git stow fish zsh bash \
            nodejs npm python python-pip \
            neovim lua54 tmux kitty \
            xorg-server-xwayland

      - name: Checkout dotfiles
        uses: actions/checkout@v4

      - name: Install lint dependencies
        run: |
          set -euo pipefail
          pacman -S --needed --noconfirm python-yaml
          pip install --no-cache-dir --upgrade pip
          pip install --no-cache-dir yamllint

      - name: Validate YAML files
        run: |
          yamllint . --format parsable --strict || true  # --strict can be too severe

      - name: Validate JSON files
        run: |
          find . -name "*.json" -type f -exec python -m json.tool {} \; > /dev/null

      - name: Validate scripts/ directory
        run: |
          if [ -d "scripts" ]; then
            find scripts -type f -name "*.sh" -exec bash -n {} \;
          fi

